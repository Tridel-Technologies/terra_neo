<div class="dash_main">
    <div class="files_container">
        <h4 style="align-self: flex-start; margin-left: 20px;">FILES</h4>

        <div class="folder" *ngFor="let folder of files_list; let i = index">
            <div class="folder-header" (click)="toggleFolder(i, folder.folder_id)">
                <img [src]="expandedFolders[i] ? 'assets/file_opened.png' : 'assets/file_closed.png'" alt="folder" />
                <div class="folder-info">
                    <p>{{ folder.folder_name }}<br><span>{{ folder.timestamp | date:'short' }}</span></p>
                </div>
                <span class="arrow">{{ expandedFolders[i] ? '▾' : '▸' }}</span>
            </div>

            <div class="file-list" *ngIf="expandedFolders[i]">
                <div [ngClass]="getFileClass(f.file_name, folder.folder_id)" *ngFor="let f of folder.files"
                    (click)="toggleFileSelection(f.file_name, $event, folder.folder_id, folder.folder_name)">
                    <img [src]="getFileImage(f.file_name)" alt="file" />
                    <p>{{ f.file_name }}</p>
                    <!-- <span class="view-btn" (click)="open_file(f)">View</span> -->
                </div>
            </div>
        </div>
    </div>
    <div class="parent">
        <div class="toggle" [style]="{'width':!isLive? '600px':'180px'}">
            <p>Live</p>
            <!-- <p-toggleswitch [(ngModel)]="isLive" (onChange)="toggle_tap()" /> -->
            <div class="tog"
                [ngStyle]="{'justify-content':isLive?'start':'end', 'background-color':!isLive?'#0fb981':'rgba(216, 216, 216, 0.853)'}"
                (click)="toggle_tap()">
                <div class="toggle_button"></div>

            </div>
            <p>+/- 6 hours</p>

            <select name="hours" *ngIf="!isLive" [(ngModel)]="hours" (change)="changeTime(hours)">
                <option [value]="6">6 hours</option>
                <option [value]="5">5 hours</option>
                <option [value]="4">4 hours</option>
                <option [value]="3">3 hours</option>
                <option [value]="2">2 hours</option>
                <option [value]="1">1 hour</option>
            </select>
            <div class="af-bf" *ngIf="!isLive">
                <p>After</p>
                <p-toggleswitch [(ngModel)]="isbefore" />
                <p>Before</p>
            </div>

        </div>
        <div class="left" *ngIf="isLive">
            <h4>{{selected_folder_name}} -> {{selectedFiles[0].file_name}}</h4>
            <div class="content">
                <p *ngFor="let dates of main_table" (click)="tap_date(dates.date, dates.time)" [ngStyle]="{
                            'background-color': 
                            selected_data.dateTime === dates.date
                            ? '#d1e7dd' : 'transparent'
                        }">
                    {{ dates.date | date :'yyyy-MM-dd HH:mm:ss' }} {{ dates.time }}
                </p>
            </div>
        </div>
        <div class="right" [ngStyle]="{'width':!isLive ?'98.5%':'76%'}">
            <div class="ids">
                <div class="station-id">
                    <h5 class="title">Station ID</h5>
                    <p class="sub-title">{{selected_data.id}}</p>
                </div>
                <div class="date-time">
                    <h5 class="title">Date</h5>
                    <p class="sub-title">{{selected_data.dateTime |date: 'yyyy-MM-dd HH:mm:ss'}}</p>
                </div>
                <div class="lat">
                    <h5 class="title">Coordinates</h5>
                    <p class="sub-title">Lon: {{selected_data.lon}} °<br> Lat: {{selected_data.lat}} °</p>
                </div>
                <div class="lon" [ngStyle]="{'background-color':isLive?'var(--background-secondary)':''}">
                    <div class="separate-bat-depth" *ngIf="!isLive">
                        <div class="bat">
                            <h5>Battery Voltage</h5>
                            <app-battery [isLive]="isLive" [percentage]="12"></app-battery>
                            <p>34</p>
                        </div>
                        <div class="depth">
                            <h5>Depth</h5>
                            <img src="../../assets/depth.png" alt="">
                            <p>{{selected_data.depth}} {{units.depth}}</p>
                        </div>
                    </div>
                    <h5 class="title" *ngIf="isLive">Depth</h5>
                    <p class="sub-title" *ngIf="isLive">{{selected_data.depth}} {{units.depth}}</p>
                </div>
            </div>
            <div class="centers">
                <!--  @for (item of Array_item; track $index) {
                <div class="tide_array">
                    <div class="icon_tide"><img src="../../assets/tide.png" alt=""></div>
                    <h4>Water Level <br> <span>1.23</span></h4>
                </div>
                } -->

                <div class="tide" *ngIf="isLive">
                    <h5 class="title-tide">Water Level</h5>
                    <img src="../../assets/tide.png" alt="">
                    <p style="align-self: center;">{{ selected_data.tide}} {{units.waterLevel}}</p>
                </div>
                @if (!isLive) {
                <div class="tide-not-live" *ngFor="let tide of filteredAvgData"
                    [ngStyle]="{'height': dynamicHeight + '%'}">
                    <img src="../../assets/tide.png" alt="">
                    <h5 class="title-tide">Water Level</h5>
                    <p style="align-self: center;">{{tide.tide}}</p>
                </div>
                }

                <!-- <div class="tide-not-live" *ngIf="!isLive">
                    <img src="../../assets/tide.png" alt="">
                    <h5 class="title-tide">Water Level</h5>
                    <p style="align-self: center;">{{af_tide}}</p>
                </div>
                <div class="tide-not-live" *ngIf="!isLive">
                    <img src="../../assets/tide.png" alt="">
                    <h5 class="title-tide">Water Level</h5>
                    <p style="align-self: center;">{{af_tide}}</p>
                </div>
                <div class="tide-not-live" *ngIf="!isLive">
                    <img src="../../assets/tide.png" alt="">
                    <h5 class="title-tide">Water Level</h5>
                    <p style="align-self: center;">{{af_tide}}</p>
                </div>
                <div class="tide-not-live" *ngIf="!isLive">
                    <img src="../../assets/tide.png" alt="">
                    <h5 class="title-tide" style="font-size: 15px;">Water Level</h5>
                    <p style="align-self: center;">{{af_tide}}</p>
                </div>
                <div class="tide-not-live" *ngIf="!isLive">
                    <img src="../../assets/tide.png" alt="">
                    <h5 class="title-tide">Water Level</h5>
                    <p style="align-self: center;">{{af_tide}}</p>
                </div> -->
                <div class="battery" *ngIf="isLive">
                    <h5 class="title-tide">Battery</h5>
                    <div class="bat">
                        <app-battery [isLive]="isLive" [percentage]="12"></app-battery>
                    </div>
                    <p style="align-self: center;">{{selected_data.battery}} {{units.battery}}</p>
                </div>
            </div>
            <div class="currents">
                <!--  <div class="currentspeed">f
                    @for (item of Array_item; track $index) {
                    <div class="tide_array">
                        <div class="icon_speed"><img src="../../assets/speed.png" alt=""></div>
                        <h4>Water Level <br> <span>1.23</span></h4>
                    </div>
                    }
                </div>
                <div class="currentdir">
                    @for (item of Array_item; track $index) {
                    <div class="tide_array">
                        <div class="icon_speed"><img src="../../assets/dire.png" alt=""></div>
                        <h4>Water Level <br> <span>1.23</span></h4>
                    </div>
                    }
                </div> -->
                <!-- @for (item of Array_item; track $index) {
                <div class="tide_array">
                    <div class="icon_tide"><img src="../../assets/tide.png" alt=""></div>
                    <h4>Water Level <br> <span>1.23</span></h4>
                </div>
                } -->
                <div class="current_speed" *ngIf="isLive">
                    <h5 class="title-tide">Current Speed</h5>
                    <img src="../../assets/speed.png" alt="">
                    <p style="align-self: center;">{{selected_data.current_speed}} {{units.currentSpeed}}</p>
                </div>
                <div class="current_direction" *ngIf="isLive">
                    <h5 class="title-tide">Current Direction</h5>
                    <img src="../../assets/dire.png" alt="">
                    <p style="align-self: center;">{{selected_data.current_direction}} {{units.currentDirection}}</p>
                </div>
                @if (!isLive) {
                <div class="current1" *ngFor="let current of filteredAvgData"
                    [ngStyle]="{'height': dynamicHeight + '%'}">
                    <h5 class="title-tide" style="margin-left: 10px;">{{current.name}}</h5>

                    <div class="c-box">
                        <div class="cbox-left">
                            <h6 style="align-self: flex-start;">Speed</h6>
                            <img class="cbox-img" src="../../assets/speed.png" alt="">
                            <p>{{current.speed}}</p>
                        </div>
                        <div class="cbox-right">
                            <h6 style="align-self: flex-start;">Direction</h6>
                            <img class="cbox-img" src="../../assets/dire.png" alt="">
                            <p>{{current.direction}}</p>
                        </div>
                    </div>
                </div>
                }

                <!-- <div class="current2" *ngIf="!isLive">
                    <h5 class="title-tide" style="margin-left: 10px;">Current </h5>

                    <div class="c-box">
                        <div class="cbox-left">
                            <h6 style="align-self: flex-start;">Speed</h6>
                            <img class="cbox-img" src="../../assets/speed.png" alt="">
                            <p>{{selected_data.current_direction}}</p>
                        </div>
                        <div class="cbox-right">
                            <h6 style="align-self: flex-start;">Direction</h6>
                            <img class="cbox-img" src="../../assets/dire.png" alt="">
                            <p>{{selected_data.current_speed}}</p>
                        </div>
                    </div>
                </div>
                <div class="current3" *ngIf="!isLive">
                    <h5 class="title-tide" style="margin-left: 10px;">Current 6 hours After</h5>
                    <div class="c-box">
                        <div class="cbox-left">
                            <h6 style="align-self: flex-start;">Speed</h6>
                            <img class="cbox-img" src="../../assets/speed.png" alt="">
                            <p>{{bf_c_speed}}</p>
                        </div>
                        <div class="cbox-right">
                            <h6 style="align-self: flex-start;">Direction</h6>
                            <img class="cbox-img" src="../../assets/dire.png" alt="">
                            <p>{{af_c_dir}}</p>
                        </div>
                    </div>
                </div>
                <div class="current3" *ngIf="!isLive">
                    <h5 class="title-tide" style="margin-left: 10px;">Current 6 hours After</h5>
                    <div class="c-box">
                        <div class="cbox-left">
                            <h6 style="align-self: flex-start;">Speed</h6>
                            <img class="cbox-img" src="../../assets/speed.png" alt="">
                            <p>{{bf_c_speed}}</p>
                        </div>
                        <div class="cbox-right">
                            <h6 style="align-self: flex-start;">Direction</h6>
                            <img class="cbox-img" src="../../assets/dire.png" alt="">
                            <p>{{af_c_dir}}</p>
                        </div>
                    </div>
                </div>
                <div class="current3" *ngIf="!isLive">
                    <h5 class="title-tide" style="margin-left: 10px;">Current 6 hours After</h5>
                    <div class="c-box">
                        <div class="cbox-left">
                            <h6 style="align-self: flex-start;">Speed</h6>
                            <img class="cbox-img" src="../../assets/speed.png" alt="">
                            <p>{{bf_c_speed}}</p>
                        </div>
                        <div class="cbox-right">
                            <h6 style="align-self: flex-start;">Direction</h6>
                            <img class="cbox-img" src="../../assets/dire.png" alt="">
                            <p>{{af_c_dir}}</p>
                        </div>
                    </div>
                </div>
                <div class="current3" *ngIf="!isLive">
                    <h5 class="title-tide" style="margin-left: 10px;">Current 6 hours After</h5>
                    <div class="c-box">
                        <div class="cbox-left">
                            <h6 style="align-self: flex-start;">Speed</h6>
                            <img class="cbox-img" src="../../assets/speed.png" alt="">
                            <p>{{bf_c_speed}}</p>
                        </div>
                        <div class="cbox-right">
                            <h6 style="align-self: flex-start;">Direction</h6>
                            <img class="cbox-img" src="../../assets/dire.png" alt="">
                            <p>{{af_c_dir}}</p>
                        </div>
                    </div>
                </div>
                <div class="current3" *ngIf="!isLive">
                    <h5 class="title-tide" style="margin-left: 10px;">Current 6 hours After</h5>
                    <div class="c-box">
                        <div class="cbox-left">
                            <h6 style="align-self: flex-start;">Speed</h6>
                            <img class="cbox-img" src="../../assets/speed.png" alt="">
                            <p>{{bf_c_speed}}</p>
                        </div>
                        <div class="cbox-right">
                            <h6 style="align-self: flex-start;">Direction</h6>
                            <img class="cbox-img" src="../../assets/dire.png" alt="">
                            <p>{{af_c_dir}}</p>
                        </div>
                    </div>
                </div> -->

                <!-- </div> -->

                <!-- <div class="tableeee" *ngIf="!isLive">
                    <table>
                        <caption>Dual Axis Table: Parameters vs Labels</caption>
                        <thead>
                            <tr class="header_table">
                                <th style="background-color: transparent;"></th>
                                <th>Tide {{units.waterLevel}}</th>
                                <th>Current Speed {{units.currentSpeed}}</th>
                                <th>Current Direction {{units.currentDirection}}</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let item of avgData"
                                [style]="{'background-color':item.name === 'Current'? 'rgb(186, 213, 247)':''}"
                                class="roww">
                                <td class="row-header">
                                    <p>{{item.name}}</p>
                                </td>
                                <td class="val">
                                    <p
                                        [style]="{'background-color':item.tide === 'N/A'?'rgb(247, 177, 177)':'','color':item.tide === 'N/A'?'red':''}">
                                        {{item.tide}}</p>

                                </td>
                                <td class="val">
                                    <p
                                        [style]="{'background-color':item.speed === 'N/A'?'rgb(247, 177, 177)':'','color':item.speed === 'N/A'?'red':''}">
                                        {{item.speed}}</p>
                                </td>
                                <td class="val">
                                    <p
                                        [style]="{'background-color':item.direction === 'N/A'?'rgb(247, 177, 177)':'','color':item.direction === 'N/A'?'red':''}">
                                        {{item.direction}}
                                    </p>

                                </td>
                            </tr>


                        </tbody>
                    </table>
                </div> -->
            </div>
        </div>
    </div>